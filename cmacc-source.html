<!-- Imports polymer -->
<link rel="import" href="../polymer/polymer.html">

<link rel="import" href="./cmacc-ast.html">
<link rel="import" href="./cmacc-sidebar.html">

<link rel="import" href="./cmacc-variable.html">
<link rel="import" href="./cmacc-section.html">

<link rel="import" href="../paper-dialog/paper-dialog.html">
<link rel="import" href="../paper-input/paper-textarea.html">
<link rel="import" href="../paper-button/paper-button.html">

<dom-module id="cmacc-source">
    <template>

        <cmacc-ast id="ast" ast="{{ast}}"></cmacc-ast>

        <paper-textarea label="Source" value="{{source}}"></paper-textarea>
        <paper-button align="right" on-tap="save">Save</paper-button>
        <paper-toast id="toast" text="Saved succesfull"></paper-toast>

    </template>
</dom-module>


<script>

    Polymer({
        is: 'cmacc-source',

        properties: {
            ast: {
                type: Object,
                observer: 'refresh'
            }
        },

        attached: function () {
            document.addEventListener('cmacc-changed', function (e) {
                this.refresh()
            }.bind(this))
        },

        refresh: function () {
            window.cmacc.serialize(this.ast, function (err, text) {
                this.source = text;
            }.bind(this))

        },

        save: function () {
            this.$.ast.parse(this.source);
            this.$.ast.save();

        }

    });
</script>